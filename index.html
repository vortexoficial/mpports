<select id="languageSelector" class="selectmenu wide" onchange="translateLanguage()">
  <option value="pt" selected>Português</option>
  <option value="en">Inglês</option>
</select>

<!-- Google Translate Element (escondido visualmente, mas funcional) -->
<div id="google_translate_element" style="position:absolute; left:-9999px;"></div>

<script>
  // ---- PERSISTÊNCIA ----
  const STORAGE_KEY = "preferredLang";      // 'pt' | 'en'
  const DEFAULT_LANG = "pt";

  function getSavedLang() {
    try { return localStorage.getItem(STORAGE_KEY) || DEFAULT_LANG; }
    catch { return DEFAULT_LANG; }
  }

  function saveLang(lang) {
    try { localStorage.setItem(STORAGE_KEY, lang); } catch {}
  }

  // ---- GOOGLE TRANSLATE ----
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'pt',
      includedLanguages: 'pt,en',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google_translate_element');
  }

  function applyLanguage(lang) {
    const combo = document.querySelector(".goog-te-combo");
    if (combo) {
      combo.value = lang;
      combo.dispatchEvent(new Event("change"));
    }
  }

  function translateLanguage() {
    const lang = document.getElementById("languageSelector").value;
    saveLang(lang);
    applyLanguage(lang);
  }

  // ---- INICIALIZAÇÃO ----
  // Define o select para o que estiver salvo
  (function initSelectFromStorage() {
    const select = document.getElementById("languageSelector");
    const saved = getSavedLang();
    if (select) select.value = saved;
  })();

  // Aguarda o combo do Google existir e aplica o idioma salvo
  const comboWaiter = setInterval(() => {
    const combo = document.querySelector(".goog-te-combo");
    if (combo) {
      clearInterval(comboWaiter);
      const saved = getSavedLang();
      applyLanguage(saved);
    }
  }, 300);

  // Garante que o idioma de página seja persistente em cookies entre recarregamentos
  window.addEventListener("load", () => {
    const savedLang = getSavedLang();
    if (savedLang === "en") {
      // Configura o idioma de página para inglês se necessário
      document.cookie = "googtrans=/pt/en; path=/";
    } else {
      document.cookie = "googtrans=/pt/pt; path=/";
    }
  });

  // Ocultar a barra do Google Translate
  window.addEventListener('load', function() {
    setTimeout(() => {
      const banner = document.querySelector(".goog-te-banner-frame");
      if (banner) {
        banner.style.display = "none"; // Esconde a barra do Google Translate
      }
    }, 2000); // Aguarda 2 segundos para garantir que o banner tenha sido carregado
  });
</script>

<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
